+++
date = "2016-03-29T19:45:25+09:00"
draft = false
title = "ファイル構成"
categories = ["ソース解説"]

+++

この文書では含まれているディレクトリやファイルがどういった意味合いなのかを解説します。

# ウェブサイトにアップロードする際に必要なファイルとディレクトリ

先にアップロードして閲覧するのに必要なファイルとディレクトリだけを書いておきます。
プロジェクトルートに対するディレクトリの構造は維持してください。

- `data/*`
- `css/*` *実はあんまり必須ではない*
- `dist/bundle.js`
- `calc.html`

# 設定ファイル

コードを書くのに使ったりする設定ファイルは以下のものです。

- `.gitignore` (バージョン管理でどのファイルを無視するか設定する)
- `package.json` (`npm`でどんなパッケージをインストールするか設定する)
- `webpack.config.js` (`webpack`に何をさせるかを設定する)

# 自動的に生成されるファイルとディレクトリ

このアプリ(プロジェクト)は全体を通して *webpack* と *npm* に強く依存しています。
その結果、いくつかのディレクトリとファイルが自動的に生成されて参照されます。

## node_modules

このディレクトリはnpmがモジュール(ライブラリ)をインストールする際に使用するディレクトリです。

webpackもこのディレクトリからモジュールを参照するので、
開発中は不必要にディレクトリを消すのは避けてください。

ただし、実際にウェブサイトとしてアップロードする際にはこのディレクトリは不要です。
ライブラリは後述するdistディレクトリに生成されるファイルに全て含まれます。

## dist

このディレクトリにwebpackは次のファイルを生成します。

- bundle.js
- test_bundle.js

`bundle.js`の方は`calc.html`で使われるJavascriptの本体です。
このファイルには使用しているライブラリが **全て** 含まれているので、
かなり大きいサイズになっているはずです。

`test_bundle.js`の方は`test.html`で使われるJavascriptファイルです。
このファイルも使用しているライブラリがいくつか含まれますが、
依存関係が(今のところ)小さいのでそこまで大きくないはずです。

# 外部データとかスタイルシート

次の場所にはbundle.jsなどのJavascriptから呼びだされて使用される
データやスタイルシートがあります。

- `data/job_data.json`
- `css/calc.css`

`data/job_data.json`については
`bundle.js`や`test_bundle.js`からFetch API経由で呼びだされるので、
絶対にプロジェクトルートからの位置は維持してください。

`css/calc.css`についてですが、
実のところこちらは`bundle.js`にビルド時に組みこまれており、
`test.html`もこれを必要としないので、アップロード時には無くてもあんまり問題はありません。

# JS/JSXファイル

これらに全て説明をつけるにはプログラム全体の説明をしなければなりませんので、
ここでは概要にとどめます。

## `entry.jsx`

エントリポイント(C/C++のmain関数相当)です。
ここでreduxのstoreを設定し、htmlと繋ぎあわせます。

## `atk_calc.js`

与えられたパラメータオブジェクトとジョブデータから
最終的な攻撃力を計算するための関数が入っています。
エラー処理はほとんどしていないのでそのあたりは呼びだし側に任されています。

## `get_job_data.js`

指定されたURLからJSONデータを読みこみPromiseオブジェクトとして返す関数が入っています。
デフォルトの読みこみURLはプロジェクトルート直下のdataディレクトリ内`job_data.json`です。

## `manupulate_form.js`

今では使っていませんが、かつて計算機のフォーム部分をテンプレート文字列を使って
操作するのに使っていました。消しても問題ありません。

## `reducers.js`

ファイルの先頭にもざっくり説明がありますが、
reduxというライブラリを使ってstoreという変数に状態(state)を保存する際に、
どういうactionオブジェクトが渡されたらstoreにどう保存するかを書いたモジュールです。

## `actions.js`

reactのコンポーネントと`reducers.js`のreducer関数を繋げるための関数群です。
redux-thunkというライブラリを使っているので、
通常のreduxとは若干違う書き方になっています。

## `calculator.jsx`

計算機全体のデザインと、結果表示などの小さなコンポーネントを集めたモジュールです。
`entry.jsx`で直接使われているモジュールです。
他のコンポーネントの多くがここから呼びだされて使われています。
計算結果を作るためstateの整形をして関数に渡しているのもこのモジュールです。
また、アプリ全体でドラッグ&ドロップを使うためにこのモジュールで準備をしています。

## `basic_information.jsx`

基本情報(ランクや攻撃力ボーナス等)を入力させるコンポーネントが入っているモジュールです。
ジョブを選択するため、reduxのstoreを通してジョブ情報を読んでいます。

## `friend.jsx`

フレンド召喚を選ぶコンポーネントが入ったモジュールです。
現在のところほとんど何も入っていません。

## `zenith.jsx`

ゼニスパークを入力させるコンポーネントが入ったモジュールです。

## `weapon.jsx`

武器構成を入力させるモジュールです。
ドラッグ&ドロップと項目の追加削除などの表示部分も担当しています。
実際にデータを動かしているのは`action.js`と`reducers.js`です。

## `summon.jsx`

召喚構成を入力させるモジュールです。
こちらも`weapon.jsx`と似たような処理をしています。

# 終わりに

コードの量自体は多く見えますが、データの流れはそこまで難しくはありません。

ほとんど全てのデータはreduxのstoreに保存され、
データが更新されると関連したモジュールが更新される、と覚えておけば
ひとまずは十分だと思います。
